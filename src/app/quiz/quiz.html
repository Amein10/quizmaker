<div class="page">
  <div class="card">
    <header class="top">
      <div class="title">üß© Quizmaker</div>
      <div class="spacer"></div>

      <!-- Spillernavn -->
      <input class="name" type="text"
             placeholder="Dit navn‚Ä¶"
             [value]="playerName"
             (input)="onNameChange($any($event.target).value)" />

      <button class="theme" (click)="toggleTheme()" [attr.aria-label]="'Skift til ' + (theme==='dark'?'lys':'m√∏rk')">
        <span *ngIf="theme==='dark'">‚òÄÔ∏è</span>
        <span *ngIf="theme==='light'">üåô</span>
      </button>
    </header>

    <!-- FILTRE -->
    <div class="filters">
      <div class="group">
        <div class="label">Kategori</div>
        <div class="chips">
          <button *ngFor="let c of categories"
                  class="chip"
                  [class.active]="c === selectedCategory"
                  (click)="setCategory(c)">{{ c }}</button>
        </div>
      </div>

      <div class="group">
        <div class="label">Sv√¶rhedsgrad</div>
        <div class="chips">
          <button *ngFor="let d of difficulties"
                  class="chip diff"
                  [class.active]="d === selectedDifficulty"
                  [attr.data-diff]="d"
                  (click)="setDifficulty(d)">{{ d }}</button>
        </div>
      </div>
    </div>

    <div class="meta">
      Sp√∏rgsm√•l {{ total ? (currentQuestionIndex + 1) : 0 }} / {{ total }}
    </div>
    <div class="progress"><div class="bar" [style.width.%]="progressPct"></div></div>

    <!-- TIMER -->
    <div class="timer" *ngIf="total > 0 && !finished">
      <div class="tbar" [style.width.%]="timePct"></div>
      <span class="tlabel">‚è±Ô∏è {{ timeLeft }}s</span>
    </div>

    <main class="content" *ngIf="total > 0 && !finished; else finishedBlock">
      <div class="fade" [class.in]="fade">
        <h2 class="question">{{ q.question }}</h2>

        <img *ngIf="q.img" [src]="q.img" alt="" class="q-img" />

        <ul class="options">
          <li *ngFor="let a of q.answers; index as i">
            <button
              class="opt"
              [class.correct]="answered && a.isCorrect"
              [class.wrong]="answered && selectedIndex === i && !a.isCorrect"
              [class.pressed]="!answered && selectedIndex === i"
              [disabled]="answered"
              (click)="selectAnswer(i)">

              <ng-container *ngIf="a.img">
                <img [src]="a.img" alt="" class="opt-img" />
              </ng-container>
              <ng-container *ngIf="a.icon && !a.img">
                <span class="opt-icon">{{ a.icon }}</span>
              </ng-container>

              <span>{{ a.text }}</span>
            </button>
          </li>
        </ul>

        <div class="feedback" *ngIf="answered">
          <span *ngIf="selectedIndex !== null && q.answers[selectedIndex!]?.isCorrect" class="ok">‚úÖ Korrekt!</span>
          <span *ngIf="selectedIndex === null || !q.answers[selectedIndex!]?.isCorrect" class="bad">
            <ng-container *ngIf="selectedIndex === null">‚è±Ô∏è Tiden l√∏b ud. </ng-container>
            Rigtigt svar er <strong>{{ correctAnswerText }}</strong>.
          </span>
        </div>

        <div class="actions">
          <button class="next" (click)="nextQuestion()" *ngIf="!isLast">N√¶ste</button>
        </div>
      </div>
    </main>

    <ng-template #finishedBlock>
      <div class="result fade in">
        <h3 *ngIf="total > 0; else noQs">üéâ Du har gennemf√∏rt quizzen!</h3>

        <!-- üëâ Score + procent -->
        <p *ngIf="total > 0">
          Score: <strong>{{ score }}</strong> / {{ total }} ‚Äî <strong>{{ percentScore }}%</strong>
        </p>

        <button *ngIf="total > 0" class="next" (click)="restart()">Pr√∏v igen</button>

        <ng-template #noQs>
          <h3>Ingen sp√∏rgsm√•l matcher dine filtre.</h3>
          <p>V√¶lg en anden kombination af kategori og sv√¶rhedsgrad.</p>
        </ng-template>

        <!-- üëâ OPSUMMERING -->
        <div class="summary" *ngIf="summary.length">
          <h4>üìù Opsummering</h4>
          <ol>
            <li *ngFor="let s of summary; index as i" [class.ok]="s.wasCorrect" [class.bad]="!s.wasCorrect">
              <div class="qline">
                <span class="badge">{{ i + 1 }}</span>
                <span class="qtxt">{{ s.q }}</span>
              </div>
              <div class="aline">
                <span *ngIf="s.selectedIndex !== null; else noAnswer">
                  Dit svar: <strong>{{ s.answers[s.selectedIndex!].text }}</strong>
                </span>
                <ng-template #noAnswer>Dit svar: <em>intet (tiden l√∏b ud)</em></ng-template>
              </div>
              <div class="cline">
                Korrekt: <strong>{{ s.answers[s.correctIndex].text }}</strong>
                <span class="status" *ngIf="s.wasCorrect">‚úÖ</span>
                <span class="status" *ngIf="!s.wasCorrect">‚ùå</span>
              </div>
            </li>
          </ol>
        </div>

        <!-- HIGHSCORES -->
        <div class="highscores" *ngIf="highscores.length">
          <h4>üèÜ Highscore ({{ selectedCategory }} / {{ selectedDifficulty }})</h4>
          <table>
            <thead><tr><th>#</th><th>Navn</th><th>Score</th><th>Procent</th><th>Dato</th></tr></thead>
            <tbody>
              <tr *ngFor="let e of highscores; index as i">
                <td>{{ i + 1 }}</td>
                <td>{{ e.name }}</td>
                <td>{{ e.score }} / {{ e.total }}</td>
                <td>{{ e.percent }}%</td>
                <td>{{ e.dateISO | date:'yyyy-MM-dd HH:mm' }}</td>
              </tr>
            </tbody>
          </table>
          <button class="danger" (click)="clearHighscores()">Nulstil highscore</button>
        </div>
      </div>
    </ng-template>
  </div>
</div>
