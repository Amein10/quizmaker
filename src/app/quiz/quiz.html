<div class="page">
  <div class="card">
    <header class="top">
      <div class="title">üß© Quizmaker</div>
      <div class="spacer"></div>
      <button class="theme" (click)="toggleTheme()" [attr.aria-label]="'Skift til ' + (theme==='dark'?'lys':'m√∏rk')">
        <span *ngIf="theme==='dark'">‚òÄÔ∏è</span>
        <span *ngIf="theme==='light'">üåô</span>
      </button>
    </header>

    <!-- KATEGORI-CHIPS -->
    <div class="cats" *ngIf="categories.length">
      <button
        *ngFor="let c of categories"
        class="chip"
        [class.active]="c === selectedCategory"
        (click)="setCategory(c)">
        {{ c }}
      </button>
    </div>

    <div class="meta">Sp√∏rgsm√•l {{ total ? (currentQuestionIndex + 1) : 0 }} / {{ total }}</div>
    <div class="progress"><div class="bar" [style.width.%]="progressPct"></div></div>

    <main class="content" *ngIf="total > 0 && !finished; else finishedBlock">
      <div class="fade" [class.in]="fade">
        <h2 class="question">{{ q.question }}</h2>

        <img *ngIf="q.img" [src]="q.img" alt="" class="q-img" />

        <ul class="options">
          <li *ngFor="let a of q.answers; index as i">
            <button
              class="opt"
              [class.correct]="answered && a.isCorrect"
              [class.wrong]="answered && selectedIndex === i && !a.isCorrect"
              [class.pressed]="!answered && selectedIndex === i"
              [disabled]="answered"
              (click)="selectAnswer(i)">

              <ng-container *ngIf="a.img">
                <img [src]="a.img" alt="" class="opt-img" />
              </ng-container>
              <ng-container *ngIf="a.icon && !a.img">
                <span class="opt-icon">{{ a.icon }}</span>
              </ng-container>

              <span>{{ a.text }}</span>
            </button>
          </li>
        </ul>

        <div class="feedback" *ngIf="answered">
          <span *ngIf="q.answers[selectedIndex!]?.isCorrect" class="ok">‚úÖ Korrekt!</span>
          <span *ngIf="!q.answers[selectedIndex!]?.isCorrect" class="bad">
            ‚ùå Forkert. Rigtigt svar er <strong>{{ correctAnswerText }}</strong>.
          </span>
        </div>

        <div class="actions">
          <button class="next" (click)="nextQuestion()" *ngIf="!isLast">N√¶ste</button>
        </div>
      </div>
    </main>

    <ng-template #finishedBlock>
      <div class="result fade in">
        <h3 *ngIf="total > 0; else noQs">üéâ Du har gennemf√∏rt quizzen!</h3>
        <p *ngIf="total > 0">Score: <strong>{{ score }}</strong> / {{ total }}</p>
        <button *ngIf="total > 0" class="next" (click)="restart()">Pr√∏v igen</button>

        <ng-template #noQs>
          <h3>Ingen sp√∏rgsm√•l i denne kategori.</h3>
          <p>V√¶lg en anden kategori.</p>
        </ng-template>
      </div>
    </ng-template>
  </div>
</div>
